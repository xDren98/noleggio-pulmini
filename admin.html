<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - Imbriani Noleggio</title>
  <link rel="stylesheet" href="styles.css">
  <meta name="description" content="Dashboard Admin - Gestione Prenotazioni Imbriani Noleggio">
</head>
<body>
  <!-- LOADING OVERLAY -->
  <div id="loading-overlay" class="loading-overlay hidden">
    <div class="spinner"></div>
    <p>Caricamento...</p>
  </div>

  <!-- LOGIN SECTION -->
  <div id="admin-login" class="admin-login">
    <div class="login-box">
      <h1>ğŸ” Admin Dashboard</h1>
      <p>Imbriani Noleggio v2.7.1</p>
      
      <form id="admin-password-form" class="form">
        <div class="form-group">
          <label for="admin-pw">Password Admin:</label>
          <input 
            type="password" 
            id="admin-pw" 
            placeholder="Inserisci password"
            required
          >
        </div>
        <button type="submit" class="btn btn-primary btn-block">
          ğŸ”“ Accedi
        </button>
      </form>
      
      <div id="login-error" class="alert alert-error hidden"></div>
      <div id="lockout-message" class="alert alert-warning hidden"></div>
    </div>
  </div>

  <!-- DASHBOARD SECTION -->
  <div id="admin-dashboard" class="admin-dashboard hidden">
    <!-- HEADER -->
    <header class="admin-header">
      <h1>ğŸ“Š Dashboard Admin</h1>
      <button id="logout-btn" class="btn btn-secondary">ğŸšª Logout</button>
    </header>

    <!-- STATS -->
    <section class="admin-stats">
      <div class="stat-card" style="cursor: pointer;" onclick="filtraPer('Totali')">
        <div class="stat-label">ğŸ“Š Totali</div>
        <div class="stat-value" id="stat-totali">0</div>
      </div>
      <div class="stat-card" style="cursor: pointer;" onclick="filtraPer('Da confermare')">
        <div class="stat-label">â³ Da Confermare</div>
        <div class="stat-value" id="stat-daconfermare">0</div>
      </div>
      <div class="stat-card" style="cursor: pointer;" onclick="filtraPer('Futura')">
        <div class="stat-label">ğŸ“… Future</div>
        <div class="stat-value" id="stat-future">0</div>
      </div>
      <div class="stat-card" style="cursor: pointer;" onclick="filtraPer('In corso')">
        <div class="stat-label">ğŸš In Corso</div>
        <div class="stat-value" id="stat-incorso">0</div>
      </div>
      <div class="stat-card" style="cursor: pointer;" onclick="filtraPer('Completata')">
        <div class="stat-label">âœ… Completate</div>
        <div class="stat-value" id="stat-completate">0</div>
      </div>
    </section>

    <!-- FILTRI -->
    <section class="admin-filters">
      <select id="filter-stato" class="form-control">
        <option value="">ğŸ”„ Tutti gli Stati</option>
        <option value="Da confermare">â³ Da Confermare</option>
        <option value="Futura">ğŸ“… Future</option>
        <option value="In corso">ğŸš In Corso</option>
        <option value="Completata">âœ… Completate</option>
      </select>
      <button id="refresh-btn" class="btn btn-info">ğŸ”„ Aggiorna</button>
      <button id="export-btn" class="btn btn-secondary">ğŸ“¥ Esporta CSV</button>
    </section>

    <!-- TABELLA PRENOTAZIONI -->
    <section class="admin-bookings">
      <h2>ğŸ“‹ Prenotazioni</h2>
      <div class="table-wrapper">
        <table class="prenotazioni-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Cliente</th>
              <th>Targa</th>
              <th>Ritiro</th>
              <th>Arrivo</th>
              <th>Importo</th>
              <th>Stato</th>
              <th>Azioni</th>
            </tr>
          </thead>
          <tbody id="bookings-tbody">
            <tr><td colspan="8" class="text-center">Caricamento prenotazioni...</td></tr>
          </tbody>
        </table>
      </div>
    </section>
  </div>

  <!-- MODAL CONFERMA PRENOTAZIONE -->
  <div id="modal-conferma" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h2>âœ… Conferma Prenotazione</h2>
        <button class="modal-close" onclick="closeModal('modal-conferma')">&times;</button>
      </div>
      <form id="form-conferma" class="form">
        <div class="form-group">
          <label>ID Prenotazione:</label>
          <input type="text" id="conferma-id" readonly>
        </div>
        <div class="form-group">
          <label>Cliente:</label>
          <input type="text" id="conferma-cliente" readonly>
        </div>
        <div class="form-group">
          <label>Targa:</label>
          <input type="text" id="conferma-targa" readonly>
        </div>
        <div class="form-group">
          <label>Periodo:</label>
          <input type="text" id="conferma-periodo" readonly>
        </div>
        <div class="form-group">
          <label for="conferma-importo">ğŸ’° Importo (â‚¬):</label>
          <input 
            type="number" 
            id="conferma-importo" 
            readonly
            placeholder="Calcolato automaticamente"
          >
          <span class="form-hint">âš ï¸ Campo calcolato automaticamente</span>
        </div>
        <div class="form-group">
          <label for="conferma-note">Note Interne:</label>
          <textarea id="conferma-note" placeholder="Note opzionali (non visibili al cliente)"></textarea>
        </div>
        <div class="modal-actions">
          <button type="submit" class="btn btn-success btn-block">
            ğŸ“„ Conferma e Genera PDF
          </button>
          <button type="button" class="btn btn-secondary btn-block" onclick="closeModal('modal-conferma')">
            âŒ Annulla
          </button>
        </div>
      </form>
      <div id="conferma-message" class="alert hidden"></div>
    </div>
  </div>

  <!-- MODAL MODIFICA PRENOTAZIONE -->
  <div id="modal-modifica" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h2>âœï¸ Modifica Prenotazione</h2>
        <button class="modal-close" onclick="closeModal('modal-modifica')">&times;</button>
      </div>
      <form id="form-modifica" class="form">
        <div class="form-group">
          <label>ID:</label>
          <input type="text" id="modifica-id" readonly>
        </div>
        <div class="form-group">
          <label for="modifica-stato">Stato:</label>
          <select id="modifica-stato" required>
            <option value="Da confermare">â³ Da Confermare</option>
            <option value="Futura">ğŸ“… Futura</option>
            <option value="In corso">ğŸš In Corso</option>
            <option value="Completata">âœ… Completata</option>
          </select>
        </div>
        <div class="form-group">
          <label for="modifica-nota">Note:</label>
          <textarea id="modifica-nota" placeholder="Note prenotazione"></textarea>
        </div>
        <div class="modal-actions">
          <button type="submit" class="btn btn-primary btn-block">ğŸ’¾ Salva</button>
          <button type="button" class="btn btn-secondary btn-block" onclick="closeModal('modal-modifica')">âŒ Annulla</button>
        </div>
      </form>
      <div id="modifica-message" class="alert hidden"></div>
    </div>
  </div>

  <!-- INFOBOX -->
  <div class="infobox">
    <h3>â„¹ï¸ Gestione stato automatica:</h3>
    <ul>
      <li>âœ… Usa il pulsante "Conferma e genera PDF" per confermare prenotazioni</li>
      <li>âœ… Lo stato viene calcolato automaticamente: Futura, In corso o Completato</li>
      <li>âœ… Puoi solo riportare manualmente a "Da confermare"</li>
    </ul>
  </div>

  <!-- TOAST CONTAINER -->
  <div id="toast-container" class="toast-container"></div>

  <!-- SCRIPTS - CONFIG FIRST! -->
  <script src="config.js"></script>
  <script src="shared-utils.js"></script>
  <script src="admin.js"></script>
</body>
</html>
