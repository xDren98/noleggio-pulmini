<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Imbriani Noleggio</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet" />
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
<style>
/* Stili aggiuntivi per tendine data */
.data-triple {
  display: flex;
  gap: 7px;
  width: 100%;
  margin-bottom: 12px;
}
.data-triple select {
  flex: 1 1 0;
  font-size: 1em;
  border-radius: 9px;
  border: 1.2px solid #c5dae5;
  background: #fff;
  color: #123035;
  padding: 9px;
  margin:0;
}
</style>
<!-- Resto del CSS invariato come prima -->
<!-- ... copia qui tutti gli altri stili come in precedenza ... -->
</head>
<body>
<script src="https://apis.google.com/js/api.js"></script>
<header>
  <h1>Imbriani Noleggio</h1>
  <p class="slogan">Dividi i costi, moltiplica il divertimento!</p>
</header>
<main>
  <div id="step1" class="step active">
    <label><span class="material-icons">calendar_today</span> Inserisci data e orario di ritiro e arrivo per verificare disponibilità.</label>

    <label><span class="material-icons">calendar_month</span> Data di ritiro</label>
    <div class="data-triple">
      <select id="giorno_ritiro"></select>
      <select id="mese_ritiro"></select>
      <select id="anno_ritiro"></select>
    </div>
    <label><span class="material-icons">access_time</span> Ora di ritiro</label>
    <select id="ora_partenza">
      <option value="08:00">08:00</option>
      <option value="12:00">12:00</option>
      <option value="16:00">16:00</option>
      <option value="20:00">20:00</option>
    </select>

    <label><span class="material-icons">calendar_month</span> Data di arrivo</label>
    <div class="data-triple">
      <select id="giorno_arrivo"></select>
      <select id="mese_arrivo"></select>
      <select id="anno_arrivo"></select>
    </div>
    <label><span class="material-icons">access_time</span> Ora di arrivo</label>
    <select id="ora_arrivo">
      <option value="08:00">08:00</option>
      <option value="12:00">12:00</option>
      <option value="16:00">16:00</option>
      <option value="20:00">20:00</option>
    </select>
    <div class="actions">
      <button onclick="controllaDisponibilita()"><span class="material-icons">search</span> Verifica Disponibilità</button>
      <button onclick="goHome()"><span class="material-icons">home</span> HOME</button>
    </div>
  </div>

  <div id="step2" class="step">
    <div id="disponibili_box">Pulmini disponibili: <span id="num_disponibili">?</span></div>
    <label for="scelta_pulmino"><span class="material-icons">directions_bus</span> Scegli il pulmino disponibile:</label>
    <select id="scelta_pulmino"></select>
    <div class="actions">
      <button id="chiamaContinuaBtn" onclick="chiamaEContinua()" disabled><span class="material-icons">call</span> Chiama per continuare la prenotazione: 328 6589618</button>
      <button onclick="goBack()"><span class="material-icons">arrow_back</span> Indietro</button>
      <button onclick="goHome()"><span class="material-icons">home</span> HOME</button>
    </div>
  </div>

  <div id="step3" class="step">
    <label for="num_autisti"><span class="material-icons">group</span> Numero autisti (max 3):</label>
    <select id="num_autisti" onchange="mostraModuliAutisti()">
      <option value="1" selected>1</option>
      <option value="2">2</option>
      <option value="3">3</option>
    </select>
    <div id="autisti_container"></div>
    <label for="cellulare"><span class="material-icons">smartphone</span> Cellulare di riferimento</label>
    <input type="tel" id="cellulare" placeholder="Inserisci un numero cellulare" />
    <div class="actions">
      <button id="btnIstruzioniContinua" onclick="vaiStep4()"><span class="material-icons">arrow_forward</span> Continua</button>
      <button onclick="goBack()"><span class="material-icons">arrow_back</span> Indietro</button>
      <button onclick="goHome()"><span class="material-icons">home</span> HOME</button>
    </div>
  </div>

  <div id="step4" class="step">
    <div id="istruzioni_modulo">
      <strong>Istruzioni per il completamento della prenotazione:</strong>
      <ol>
        <li>Si aprirà una nuova finestra con il modulo di prenotazione precompilato con i dati inseriti finora.</li>
        <li>Verifica attentamente che tutti i dati siano corretti.</li>
        <li>Scorri fino in fondo al modulo e clicca <em>Invia</em> per completare la prenotazione.</li>
        <li>Se hai indicato meno di tre autisti, puoi lasciare vuoti i campi dedicati agli autisti non indicati.</li>
      </ol>
      <p id="avviso_leggimi">Leggi attentamente prima di procedere!</p>
    </div>
    <div class="actions">
      <button id="btnApriModulo" disabled><span class="material-icons">directions_bus</span> Controlla e invia i tuoi dati (10)</button>
      <button onclick="goBack()"><span class="material-icons">arrow_back</span> Indietro</button>
      <button onclick="goHome()"><span class="material-icons">home</span> HOME</button>
    </div>
  </div>

  <div id="step5" class="step">
    <div id="thankyou" style="background: rgba(241, 245, 250, 0.93); padding: 36px 18px; border-radius: 18px; text-align: center; box-shadow: 0 0 28px #bddaff;">
      <h2 style="color: #2690c9; margin-bottom: 18px;">Grazie per aver scelto Imbriani Noleggio!</h2>
      <p style="font-size: 1.25em; color: #106391; font-weight: 600;">
        Ti abbiamo inviato il modulo di prenotazione.<br />Ti auguriamo un viaggio piacevole e sicuro!
      </p>
      <button type="button" onclick="goHome()" style="margin-top: 26px; background: #2690c9; padding: 12px 24px; border-radius: 12px; font-size: 1.09em; font-weight: 700; color: #fff; margin-bottom:5px;">
        <span class="material-icons">home</span>Torna all'inizio
      </button>
    </div>
  </div>
</main>
<div id="progressContainer">
  <div id="progressBar">
    <div id="progressFill"></div>
    <img id="progressIcon" src="pulmino.png" alt="Pulmino" />
    <img id="finishFlag" src="traguardo.png" alt="Traguardo" />
  </div>
  <span id="progressPercent">0%</span>
</div>
<script>
console.log("Versione 3.0 menu a tendine data");

// Popola tutte le tendine data nelle varie sezioni
function popolaTendineData(giornoId, meseId, annoId, annoStart, annoEnd) {
  const selG = document.getElementById(giornoId);
  const selM = document.getElementById(meseId);
  const selA = document.getElementById(annoId);
  selG.innerHTML = '<option value="">GG</option>';
  for (let i = 1; i<=31; i++) selG.innerHTML += `<option value="${i.toString().padStart(2,'0')}">${i}</option>`;
  selM.innerHTML = '<option value="">MM</option>';
  for (let i=1; i<=12; i++) selM.innerHTML += `<option value="${i.toString().padStart(2,'0')}">${i}</option>`;
  selA.innerHTML = '<option value="">AAAA</option>';
  for (let i = annoEnd; i>=annoStart; i--) selA.innerHTML += `<option value="${i}">${i}</option>`;
}

// Esegui all'avvio per quelle fisse (ritiro, arrivo)
document.addEventListener('DOMContentLoaded', function() {
  // Ritiro e arrivo: range anni 2023-2030
  const annoCorrente = new Date().getFullYear();
  popolaTendineData('giorno_ritiro', 'mese_ritiro', 'anno_ritiro', annoCorrente, annoCorrente+5);
  popolaTendineData('giorno_arrivo', 'mese_arrivo', 'anno_arrivo', annoCorrente, annoCorrente+5);
  mostraModuliAutisti();
  if (window.gapi) {
    loadSheetsApi();
  } else {
    let checkGapi = setInterval(function () {
      if (window.gapi) {
        clearInterval(checkGapi);
        loadSheetsApi();
      }
    }, 100);
  }
});

function getValoreDataPrefisso(prefisso, i, inizioAnno, fineAnno) {
  const gg = document.getElementById('giorno_' + prefisso + '_' + i).value;
  const mm = document.getElementById('mese_' + prefisso + '_' + i).value;
  const aa = document.getElementById('anno_' + prefisso + '_' + i).value;
  return (gg && mm && aa) ? (gg + '/' + mm + '/' + aa) : '';
}

function getDataRitiroArrivo(prefix) {
  const gg = document.getElementById('giorno_' + prefix).value;
  const mm = document.getElementById('mese_' + prefix).value;
  const aa = document.getElementById('anno_' + prefix).value;
  return (gg && mm && aa) ? (gg + '/' + mm + '/' + aa) : '';
}

// ... Altra logica JS come controllaDisponibilita, goBack, goHome, ecc...

/********** Sostituisci nelle funzioni tutti i riferimenti al valore di data input **********/

function controllaDisponibilita() {
  const dataRitiro = getDataRitiroArrivo('ritiro');
  const oraRitiro = document.getElementById('ora_partenza').value;
  const dataArrivo = getDataRitiroArrivo('arrivo');
  const oraArrivo = document.getElementById('ora_arrivo').value;
  if (!dataRitiro || !oraRitiro || !dataArrivo || !oraArrivo) {
    alert('Inserisci data e ora validi.');
    return;
  }
  // ... resto come prima ...
}

// Moduli autisti
function mostraModuliAutisti() {
  const container = document.getElementById('autisti_container');
  const num = parseInt(document.getElementById('num_autisti').value);
  container.innerHTML = '';
  for (let i = 1; i <= num; i++) {
    container.innerHTML += `<div class="autista">
      <h3>Autista ${i}</h3>
      <label>Nome e Cognome</label><input type="text" id="nome_cognome_${i}" required />
      <label>Data di nascita</label>
        <div class="data-triple">
          <select id="giorno_nascita_${i}"></select>
          <select id="mese_nascita_${i}"></select>
          <select id="anno_nascita_${i}"></select>
        </div>
      <label>Luogo di nascita</label><input type="text" id="luogo_nascita_${i}" required />
      <label>Comune di residenza</label><input type="text" id="comune_residenza_${i}" required />
      <label>Via di residenza</label><input type="text" id="via_residenza_${i}" required />
      <label>Civico di residenza</label><input type="text" id="civico_residenza_${i}" required />
      <label>Codice fiscale</label><input type="text" id="codice_fiscale_${i}" required />
      <label>Numero patente</label><input type="text" id="numero_patente_${i}" required />
      <label>Data inizio validità patente</label>
        <div class="data-triple">
          <select id="giorno_inizio_validita_patente_${i}"></select>
          <select id="mese_inizio_validita_patente_${i}"></select>
          <select id="anno_inizio_validita_patente_${i}"></select>
        </div>
      <label>Data fine validità patente</label>
        <div class="data-triple">
          <select id="giorno_fine_validita_patente_${i}"></select>
          <select id="mese_fine_validita_patente_${i}"></select>
          <select id="anno_fine_validita_patente_${i}"></select>
        </div>
    </div>`;
  }

  // popola le tendine per i campi dinamici
  const annoCorrente = new Date().getFullYear();
  for (let i = 1; i <= num; i++) {
    popolaTendineData(`giorno_nascita_${i}`, `mese_nascita_${i}`, `anno_nascita_${i}`, 1940, annoCorrente - 16);
    popolaTendineData(`giorno_inizio_validita_patente_${i}`, `mese_inizio_validita_patente_${i}`, `anno_inizio_validita_patente_${i}`, annoCorrente - 50, annoCorrente + 10);
    popolaTendineData(`giorno_fine_validita_patente_${i}`, `mese_fine_validita_patente_${i}`, `anno_fine_validita_patente_${i}`, annoCorrente, annoCorrente + 15);
  }
}

// Quando crei l'URL per Google Form o altro recupera i dati con le funzioni sopra, es:
// getValoreDataPrefisso('nascita', i, ...)
// getValoreDataPrefisso('inizio_validita_patente', i, ...)
// getValoreDataPrefisso('fine_validita_patente', i, ...)

</script>
</body>
</html>
